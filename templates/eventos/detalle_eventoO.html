{% extends 'partials/base.html' %}
{% block title %}Detalle del evento{% endblock %}

{% block content %}
<div class="evento-card p-6 border rounded-lg shadow bg-white">
  <h2 class="text-2xl font-bold mb-2">{{ evento.titulo }}</h2>
  <p><strong>Fecha:</strong> {{ evento.fecha|date:"d M Y H:i" }}</p>
  <p><strong>Lugar:</strong> {{ evento.lugar }}</p>

  <h3 class="estado-title mt-6 text-lg font-semibold">Estado de boletos</h3>
  <div class="estado-boletos mt-2 space-y-1">
    <div><span class="font-medium">Cupo m√°ximo:</span> {{ evento.cupo_maximo }}</div>
    <div><span class="font-medium">Vendidos:</span> {{ boletos_vendidos }}</div>
    <div><span class="font-medium">Disponibles:</span> {{ boletos_disponibles }}</div>
    <div><span class="font-medium">Porcentaje vendido:</span> {{ porcentaje_vendido|default:0 }}%</div>
    <div><span class="font-medium">Ingresos totales:</span> ${{ ingresos_totales }}</div>

    <div class="progress-bar w-full bg-gray-200 h-4 rounded mt-2">
      <div class="progress bg-green-500 h-4 rounded" style="width: {{ porcentaje_vendido|default:0 }}%;"></div>
    </div>
  </div>

  <!-- Tabla de compradores -->
  <h3 class="mt-8 text-lg font-semibold">Compradores</h3>
  <table class="tabla-compradores w-full border mt-2 text-sm">
    <thead>
      <tr class="bg-gray-100">
        <th class="p-2 text-left">Usuario</th>
        <th class="p-2 text-left">C√≥digo Ticket</th>
        <th class="p-2 text-left">Estado</th>
        <th class="p-2 text-left">Fecha Registro</th>
      </tr>
    </thead>
    <tbody>
      {% for ticket in tickets %}
        <tr class="{% if forloop.counter > 5 %}oculto{% endif %}">
          <td class="p-2">{{ ticket.usuario.username }}</td>
          <td class="p-2">{{ ticket.codigo_unico }}</td>
          <td class="p-2">{{ ticket.get_estado_display }}</td>
          <td class="p-2">{{ ticket.fecha_registro|date:"d M Y H:i" }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4" class="p-2 text-gray-500">No hay compradores registrados a√∫n.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if tickets|length > 5 %}
    <button id="toggle-btn" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded">
      Ver m√°s compradores
    </button>
  {% endif %}

  <!-- Botones -->
  <div class="flex justify-between mt-8">
    <a href="{% url 'panel_organizador' %}" 
       class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">
      ‚Üê Volver
    </a>
    <a href="{% url 'eliminar_evento' evento.id %}" 
       class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition"
       onclick="return confirm('¬øSeguro que quieres eliminar este evento?');">
      üóë Eliminar evento
    </a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("toggle-btn");
    if (btn) {
      btn.addEventListener("click", function () {
        const ocultos = document.querySelectorAll(".tabla-compradores .oculto");
        const mostrando = ocultos.length && ocultos[0].style.display === "table-row";

        if (mostrando) {
          ocultos.forEach(row => row.style.display = "none");
          btn.textContent = "Ver m√°s compradores";
        } else {
          ocultos.forEach(row => row.style.display = "table-row");
          btn.textContent = "Ver menos compradores";
        }
      });
    }
  });
</script>
{% endblock %}
